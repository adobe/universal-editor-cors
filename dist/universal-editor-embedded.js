/*
 * Copyright 2023 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */

(()=>{(l=d||(d={})).Call="call",l.Reply="reply",l.Syn="syn",l.SynAck="synAck",l.Ack="ack",(a=s||(s={})).Fulfilled="fulfilled",a.Rejected="rejected",(c=u||(u={})).ConnectionDestroyed="ConnectionDestroyed",c.ConnectionTimeout="ConnectionTimeout",c.NoIframeSrc="NoIframeSrc",(E||(E={})).DataCloneError="DataCloneError",(p||(p={})).Message="message";var e,t,r,n,o,i,l,a,c,d,s,u,E,p,m,f,g,T,v;let y=({name:e,message:t,stack:r})=>({name:e,message:t,stack:r});var h=(e,t,r)=>{let{localName:n,local:o,remote:i,originForSending:l,originForReceiving:a}=e,c=!1,u=e=>{if(e.source!==i||e.data.penpal!==d.Call)return;if("*"!==a&&e.origin!==a)return void r(`${n} received message from origin ${e.origin} which did not match expected origin ${a}`);let{methodName:o,args:u,id:p}=e.data;r(`${n}: Received ${o}() call`);let m=e=>t=>{if(r(`${n}: Sending ${o}() reply`),c)return void r(`${n}: Unable to send ${o}() reply due to destroyed connection`);let a={penpal:d.Reply,id:p,resolution:e,returnValue:t};e===s.Rejected&&t instanceof Error&&(a.returnValue=y(t),a.returnValueIsError=!0);try{i.postMessage(a,l)}catch(e){if(e.name===E.DataCloneError){let t={penpal:d.Reply,id:p,resolution:s.Rejected,returnValue:y(e),returnValueIsError:!0};i.postMessage(t,l)}throw e}};new Promise((e=>e(t[o].apply(t,u)))).then(m(s.Fulfilled),m(s.Rejected))};return o.addEventListener(p.Message,u),()=>{c=!0,o.removeEventListener(p.Message,u)}};let R=0;let b=e=>e?e.split("."):[],N=(e,t,r)=>{let n=b(t);return n.reduce(((e,t,o)=>(void 0===e[t]&&(e[t]={}),o===n.length-1&&(e[t]=r),e[t])),e),e},I=(e,t)=>{let r={};return Object.keys(e).forEach((n=>{let o=e[n],i=((e,t)=>{let r=b(t||"");return r.push(e),(e=>e.join("."))(r)})(n,t);"object"==typeof o&&Object.assign(r,I(o,i)),"function"==typeof o&&(r[i]=o)})),r};var C=(e,t,r,n,o)=>{let{localName:i,local:l,remote:a,originForSending:c,originForReceiving:E}=t,m=!1;o(`${i}: Connecting call sender`);let f=e=>(...t)=>{let r;o(`${i}: Sending ${e}() call`);try{a.closed&&(r=!0)}catch(e){r=!0}if(r&&n(),m){let t=Error(`Unable to send ${e}() call due to destroyed connection`);throw t.code=u.ConnectionDestroyed,t}return new Promise(((r,n)=>{let u=++R,m=t=>{if(t.source!==a||t.data.penpal!==d.Reply||t.data.id!==u)return;if("*"!==E&&t.origin!==E)return void o(`${i} received message from origin ${t.origin} which did not match expected origin ${E}`);let c=t.data;o(`${i}: Received ${e}() reply`),l.removeEventListener(p.Message,m);let f=c.returnValue;c.returnValueIsError&&(f=(e=>{let t=Error();return Object.keys(e).forEach((r=>t[r]=e[r])),t})(f)),(c.resolution===s.Fulfilled?r:n)(f)};l.addEventListener(p.Message,m);let f={penpal:d.Call,id:u,methodName:e,args:t};a.postMessage(f,c)}))};return Object.assign(e,(e=>{let t={};for(let r in e)N(t,r,e[r]);return t})(r.reduce(((e,t)=>(e[t]=f(t),e)),{}))),()=>{m=!0}},S=(e,t)=>{let r;return void 0!==e&&(r=window.setTimeout((()=>{let r=Error(`Connection timed out after ${e}ms`);r.code=u.ConnectionTimeout,t(r)}),e)),()=>{clearTimeout(r)}};var A=(e={})=>{let{parentOrigin:t="*",methods:r={},timeout:n,debug:o=!1}=e,i=(e=>(...t)=>{e&&console.log("[Penpal]",...t)})(o),l=((e,t)=>{let r=[],n=!1;return{destroy(o){n||(n=!0,t(`${e}: Destroying connection`),r.forEach((e=>{e(o)})))},onDestroy(e){n?e():r.push(e)}}})("Child",i),{destroy:a,onDestroy:c}=l,s=((e,t,r,n)=>{let{destroy:o,onDestroy:i}=r;return r=>{if(!(e instanceof RegExp?e.test(r.origin):"*"===e||e===r.origin))return void n(`Child: Handshake - Received SYN-ACK from origin ${r.origin} which did not match expected origin ${e}`);n("Child: Handshake - Received SYN-ACK, responding with ACK");let l="null"===r.origin?"*":r.origin,a={penpal:d.Ack,methodNames:Object.keys(t)};window.parent.postMessage(a,l);let c={localName:"Child",local:window,remote:window.parent,originForSending:l,originForReceiving:r.origin};i(h(c,t,n));let s={};return i(C(s,c,r.data.methodNames,o,n)),s}})(t,I(r),l,i),u=()=>{i("Child: Handshake - Sending SYN");let e={penpal:d.Syn};window.parent.postMessage(e,t instanceof RegExp?"*":t)};return{promise:new Promise(((e,t)=>{let r=S(n,a),o=t=>{if((()=>{try{clearTimeout()}catch(e){return!1}return!0})()&&t.source===parent&&t.data&&t.data.penpal===d.SynAck){let n=s(t);n&&(window.removeEventListener(p.Message,o),r(),e(n))}};window.addEventListener(p.Message,o),u(),c((e=>{window.removeEventListener(p.Message,o),e&&t(e)}))})),destroy(){a()}}};(e=m||(m={})).DRAFT="draft",e.PUBLISHED="published",e.UNPUBLISHED="unpublished",e.OUTDATED="outdated",e.UNKNOWN="unknown",(t=f||(f={})).PAGE="page",t.CONTENT_FRAGMENT="content-fragment",t.EXPERIENCE_FRAGMENT="experience-fragment",t.ASSET="asset",t.TEMPLATE="template",t.POLICIES="policies",t.PRODUCT="product",t.CATALOG="catalog",t.TAG="tag",t.OTHERS="others";let O=Object.freeze({UUID:"id",RESOURCE:"resource",TYPE:"type",PROP:"prop",PARENTID:"parentid",BEHAVIOR:"behavior",LABEL:"label",MODEL:"model",FILTER:"filter"});(r=g||(g={})).EDIT="edit",r.PREVIEW="preview",(n=T||(T={})).TEXT="text",n.MEDIA="media",n.RICHTEXT="richtext",n.REFERENCE="reference",n.CONTAINER="container",n.COMPONENT="component",(o=v||(v={})).TEXT="text",o.MEDIA="media",o.RICHTEXT="richtext",o.REFERENCE="reference",o.CONTAINER="container",o.COMPONENT="component",Object.freeze({BLOCKS:"blocks",FORMAT:"format",ALIGNMENT:"alignment",INDENTATION:"indentation",SR_SCRIPT:"sr_script",LIST:"list",INSERT:"insert",ADVANCED:"advanced",EXTENSIONS:"extensions",EDITOR:"editor"});let w="urn:adobe:aue:",P=`meta[name^='${w}']`,$=`meta[name='${w}config:namespace']`,_=(O.TYPE,{URN_PREFIX:w,META_SELECTOR:P,META_NAMESPACE:$,USER_INPUT_RELAY_MESSAGE:"REMOTE_APP_USER_INPUT",DEFAULT_PREFIX:"data-aue-",COMPONENT_ITEM_TYPE:"component",RTE_URL:"https://exc-unifiedcontent.experience.adobe.net/solutions/CQ-aem-headless-rte/assets/tinymce-681/js/tinymce/tinymce.min.js",EVENT_APP_INITIALIZED:"aue:initialized",EVENT_UI_SELECT:"aue:ui-select",EVENT_UI_PREVIEW:"aue:ui-preview",EVENT_UI_EDIT:"aue:ui-edit",EVENT_CONTENT_MOVE:"aue:content-move",EVENT_CONTENT_ADD:"aue:content-add",EVENT_CONTENT_PATCH:"aue:content-patch",EVENT_CONTENT_REMOVE:"aue:content-remove"});var M;function L(e,t,r){function n(){var d=Date.now()-a;d<t&&d>=0?o=setTimeout(n,t-d):(o=null,r||(c=e.apply(l,i),l=i=null))}null==t&&(t=100);var o,i,l,a,c,d=function(){l=this,i=arguments,a=Date.now();var d=r&&!o;return o||(o=setTimeout(n,t)),d&&(c=e.apply(l,i),l=i=null),c};return d.clear=function(){o&&(clearTimeout(o),o=null)},d.flush=function(){o&&(c=e.apply(l,i),l=i=null,clearTimeout(o),o=null)},d}L.debounce=L,M=L;var D=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;let U=[];for(let e=0;e<256;++e)U.push((e+256).toString(16).slice(1));function V(e,t){return e<<t|e>>>32-t}let x=function(e,t,r){function n(e,t,r,n){var o;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof t&&(t=function(e){let t;if("string"!=typeof e||!D.test(e))throw TypeError("Invalid UUID");let r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}(t)),16!==(null===(o=t)||void 0===o?void 0:o.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let i=new Uint8Array(16+e.length);if(i.set(t),i.set(e,t.length),(i=function(e){let t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let n=Math.ceil((e.length/4+2)/16),o=Array(n);for(let t=0;t<n;++t){let r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=e[64*t+4*n]<<24|e[64*t+4*n+1]<<16|e[64*t+4*n+2]<<8|e[64*t+4*n+3];o[t]=r}o[n-1][14]=8*(e.length-1)/4294967296,o[n-1][14]=Math.floor(o[n-1][14]),o[n-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<n;++e){let n=new Uint32Array(80);for(let t=0;t<16;++t)n[t]=o[e][t];for(let e=16;e<80;++e)n[e]=V(n[e-3]^n[e-8]^n[e-14]^n[e-16],1);let i=r[0],l=r[1],a=r[2],c=r[3],d=r[4];for(let e=0;e<80;++e){let r=Math.floor(e/20),o=V(i,5)+function(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}(r,l,a,c)+d+t[r]+n[e]>>>0;d=c,c=a,a=V(l,30)>>>0,l=i,i=o}r[0]=r[0]+i>>>0,r[1]=r[1]+l>>>0,r[2]=r[2]+a>>>0,r[3]=r[3]+c>>>0,r[4]=r[4]+d>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}(i))[6]=15&i[6]|80,i[8]=63&i[8]|128,r){n=n||0;for(let e=0;e<16;++e)r[n+e]=i[e];return r}return function(e,t=0){return U[e[t+0]]+U[e[t+1]]+U[e[t+2]]+U[e[t+3]]+"-"+U[e[t+4]]+U[e[t+5]]+"-"+U[e[t+6]]+U[e[t+7]]+"-"+U[e[t+8]]+U[e[t+9]]+"-"+U[e[t+10]]+U[e[t+11]]+U[e[t+12]]+U[e[t+13]]+U[e[t+14]]+U[e[t+15]]}(i)}try{n.name="v5"}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}(),F={element:window.document},k=0,j=(e=_.DEFAULT_PREFIX)=>{let t={};for(let r in O)t[r]=`${e}${O[r]}`;return t},H=(e,t)=>{if(!(e&&e instanceof HTMLElement&&t))return"";let r="";return t===v.TEXT?r=e.textContent||e.innerText:t===v.RICHTEXT?r=e.innerHTML:t===v.MEDIA&&(r=e.src),r},q="OverlayBlockingElement",X=()=>{Y(),(()=>{let e=document.createElement("div");e.id=q,e.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 2147483647;",document.body.appendChild(e)})()},Y=()=>{let e=document.getElementById(q);e&&e.remove()},K=j(),B=new Map,W=e=>{let t=e.closest(`[${K.RESOURCE}]`);return{cfid:(null==t?void 0:t.getAttribute(K.RESOURCE))||"",prop:(null==t?void 0:t.getAttribute(K.PROP))||""}},z=(e,{resource:t,type:r,prop:n})=>{let o="",i="",l="";if(t){o=`[${K.RESOURCE}="${t}"]`;let r=(e=>{var t;let r=null===(t=e.parentElement)||void 0===t?void 0:t.closest(`[${K.TYPE}="${v.CONTAINER}"]:is([${K.RESOURCE}],[${K.PROP}]`),n=null==r?void 0:r.getAttribute(K.RESOURCE),o=null==r?void 0:r.getAttribute(K.PROP);if(n)return{parentResource:n,parentID:G([n,o],!0)};let i=r&&W(r).cfid;return o&&i?{parentResource:i,parentID:G([i,o],!0)}:void 0})(e);i=(null==r?void 0:r.parentID)||"",l=(null==r?void 0:r.parentResource)||""}else{let t=W(e);i=G([l=t.cfid,t.prop],!0),o=`[${K.RESOURCE}="${l}"] ${e.tagName.toLocaleLowerCase()}[${K.TYPE}="${r}"]`}return n&&(o+=`[${K.PROP}="${n}"]`),{parentid:i,parentResource:l,selector:o,isComponent:r===_.COMPONENT_ITEM_TYPE||e.getAttribute(K.BEHAVIOR)===_.COMPONENT_ITEM_TYPE}},G=(e,t=!1)=>{let r=e.filter((e=>!!e)).join("_");if(t&&B.has(r))return B.get(r);let n=`_${(e=>(k++,`${e||"id"}${k}`))()}`,o=x(`${r}${n}`,x.URL);return B.set(r,o),o},Z=e=>{let{scrollLeft:t,scrollTop:r}=e.documentElement,n=e.querySelectorAll(`[${K.RESOURCE}],[${K.PROP}]`)||[],o=new Map;return k=0,B.clear(),n.forEach((e=>{let t=(e=>{let t=e.getAttribute(null==K?void 0:K.TYPE),r=e.getAttribute(K.RESOURCE),n=e.getAttribute(K.PROP);if(!r&&!n)return;let o=e.getAttribute(K.MODEL)||"",{parentid:i,parentResource:l,selector:a,isComponent:c}=z(e,{resource:r,type:t,prop:n});return{id:G([r||l,n]),type:t||"",resource:r||"",prop:n||"",model:o,rect:e.getBoundingClientRect(),label:e.getAttribute(K.LABEL)||"",parentid:i,selector:a,pageYOffset:window.scrollY,isComponent:c,filter:e.getAttribute(K.FILTER)||"",content:H(e,t),modeltype:o}})(e);if(t){let e=o.get(t.id);if(o.set(t.id,{...t,children:(null==e?void 0:e.children)||[]}),t.parentid&&t.id!==t.parentid){let e=o.get(t.parentid);e?e.children.push(t.id):o.set(t.parentid,{children:[t.id]})}}})),{editables:o,offset:{x:t,y:r},selected:{}}},J={viewport:{width:0,height:0},frame:{width:0,height:0},scroll:{x:0,y:0}},Q=({editor:e})=>{null==e||e.updateFrameDetails({details:J})},ee=({target:e})=>{let t=e.documentElement;J.scroll.x=t.scrollLeft,J.scroll.y=t.scrollTop},te=({target:e})=>{let t=Math.max(e.document.documentElement.clientWidth||0,e.innerWidth||0),r=Math.max(e.document.documentElement.clientHeight||0,e.innerHeight||0),{width:n,height:o}=e.document.documentElement.getBoundingClientRect();J.viewport={width:t,height:r},J.frame={width:Math.ceil(n),height:Math.ceil(o)}},re=({editor:e,prefix:t})=>{let r=F.element;t&&t!==_.DEFAULT_PREFIX&&Object.assign(K,j(t));let n=(0,M.debounce)((()=>{let t=Z(r);e.repaintEditables({editables:t})}),150);n(),window.removeEventListener("resize",n),window.addEventListener("resize",n),(({element:e,callback:t})=>{let r=new MutationObserver(t);r.observe(e,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),r.disconnect})({element:r,callback:n})},ne=({editor:e})=>{let t=window;t.document.addEventListener("scroll",(0,M.debounce)((({target:t})=>{ee({target:t}),Q({editor:e})}),150)),t.addEventListener("resize",(0,M.debounce)((({target:t})=>{te({target:t}),Q({editor:e})}),150)),t.addEventListener("orientationchange",(0,M.debounce)((({target:r})=>{ee({target:t.document}),te({target:r}),Q({editor:e})}),150));let r=(0,M.debounce)((()=>{te({target:t}),Q({editor:e})}),150),n=new ResizeObserver(r);n.observe(t.document.documentElement),n.observe(t.document.body),requestAnimationFrame((()=>{ee({target:t.document}),te({target:t}),Q({editor:e})}))},oe=({editor:e})=>{document.addEventListener("click",(t=>(({event:e,editor:t})=>{let r=e.target.closest("A");r&&(e.preventDefault(),t.navigateTo({href:r.href}))})({event:t,editor:e})),{capture:!0})},ie=()=>{window.addEventListener("keydown",(({type:e,key:t,altKey:r,metaKey:n,shiftKey:o,ctrlKey:i})=>{parent.postMessage({type:_.USER_INPUT_RELAY_MESSAGE,value:{type:e,key:t,altKey:r,metaKey:n,shiftKey:o,ctrlKey:i}},"*")}))},le=Object.freeze({edit:"adobe-ue-edit",preview:"adobe-ue-preview"}),ae="application/vnd.adobe.aue.";var ce={},de=function(e){var t,r=new Set,n=function(e,n){var o="function"==typeof e?e(t):e;if(!Object.is(o,t)){var i=t;t=(null!=n?n:"object"!=typeof o||null===o)?o:Object.assign({},t,o),r.forEach((function(e){return e(t,i)}))}},o=function(){return t},i={setState:n,getState:o,subscribe:function(e){return r.add(e),function(){return r.delete(e)}},destroy:function(){r.clear()}};return t=e(n,o,i),i},se=function(e){return e?de(e):de},ue=function(e){return se(e)};ce.createStore=se,ce.default=ue,(ce=ue).createStore=se,ce.default=ce;let Ee=({set:e},t)=>{e((e=>({...e,editor:t})))},pe=({set:e},{mode:t})=>{e((e=>{let r=t===g.EDIT||t===g.PREVIEW;return{...e,mode:t,isInEditor:r}}))},me=({set:e},t)=>{e((e=>({...e,prefix:t})))},fe=(0,ce.createStore)((i=(e,t)=>({mode:g.PREVIEW,isInEditor:!1,prefix:null,editor:null,setMode:pe.bind(null,{get:t,set:e}),setPrefix:me.bind(null,{get:t,set:e}),setEditor:Ee.bind(null,{get:t,set:e})}),function(e,t,r){var n=r.subscribe;return r.subscribe=function(e,t,o){var i=e;if(t){var l=(null==o?void 0:o.equalityFn)||Object.is,a=e(r.getState());i=function(r){var n=e(r);if(!l(a,n)){var o=a;t(a=n,o)}},null!=o&&o.fireImmediately&&t(a,a)}return n(i)},i(e,t)})),ge=({editable:e,config:t},r=0)=>{var n;if(!window.tinymce)return void(r<3&&setTimeout((()=>ge({editable:e,config:t},r+1)),100));Y();let o=e.selector&&(null===(n=document.querySelector(e.selector))||void 0===n?void 0:n.tagName);tinymce.init({forced_root_block:o||"p",...t,setup:t=>{t.on("init",(()=>tinymce.activeEditor.focus())),t.on("keyup",(e=>"Escape"===e.key&&e.target.blur())),t.on("blur",(r=>{((e,t)=>{let{editor:r}=fe.getState(),{bodyElement:n,startContent:o}=null==e?void 0:e.target;null==r||r.closeRTE({editable:t,isModified:o!==n.innerHTML,newContent:{html:n.innerHTML,text:n.textContent}})})(r,e),((e,t)=>{e.preventDefault(),e.stopImmediatePropagation(),t.remove(),X()})(r,t)}))}})},Te=(e,t,r)=>{let n=new CustomEvent(e,{bubbles:!0,detail:r}),o=t?document.querySelector(t):document.body;return null==o||o.dispatchEvent(n),!!o},ve=({selector:e,classNames:t,operation:r="toggle"})=>{let n=document.querySelector(e);if(n)for(let e of t)n.classList[r](e)},ye=({containerSelector:e,selector:t,beforeSelector:r,refresh:n})=>{let o=t&&document.querySelector(t),i=document.querySelector(e);o&&i?((e,t,r)=>{r?document.querySelector(r).before(e):t.appendChild(e)})(o,i,r):n&&window.location.reload()},he=()=>{document.addEventListener(_.EVENT_CONTENT_MOVE,(e=>{let{prefix:t}=fe.getState(),{component:r,to:n,before:o}=e.detail;ye({containerSelector:`[${t}${O.RESOURCE}="${n}"]`,selector:`[${t}${O.RESOURCE}="${r}"]`,beforeSelector:o?`[${t}${O.RESOURCE}="${o}"]`:void 0})})),document.addEventListener(_.EVENT_UI_SELECT,(e=>{let t=e.target;t&&e.detail.selected&&(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView({block:"nearest"}))})),document.addEventListener(_.EVENT_CONTENT_PATCH,(e=>{let{prefix:t}=fe.getState(),{request:r,patch:n}=null==e?void 0:e.detail,{resource:o}=null==r?void 0:r.target,{name:i,value:l}=n,a=document.querySelector(`[${t}${O.RESOURCE}="${o}"]`),c=null==a?void 0:a.getAttribute(`${t}${O.PROP}`);if(i&&c!==i&&(a=null==a?void 0:a.querySelector(`[${t}${O.PROP}='${i}']`)),!a)return void window.location.reload();let d=a.getAttribute(`${t}${O.TYPE}`);d===v.MEDIA?a.src=l:d===v.TEXT||d===v.RICHTEXT?a.innerHTML=l:window.location.reload()})),document.addEventListener(_.EVENT_CONTENT_REMOVE,(e=>{var t;let r=null===(t=null==e?void 0:e.detail)||void 0===t?void 0:t.resource;if(!r)return;let{prefix:n}=fe.getState(),o=document.querySelector(`[${n}${O.RESOURCE}="${r}"]`);o&&o.remove()})),document.addEventListener(_.EVENT_CONTENT_ADD,(()=>{window.location.reload()})),document.addEventListener(_.EVENT_UI_EDIT,(()=>{Re(g.EDIT)})),document.addEventListener(_.EVENT_UI_PREVIEW,(()=>{Re(g.PREVIEW)}))},Re=e=>{if(!e)return;let{mode:t,setMode:r}=fe.getState();ve({selector:"html",classNames:[le[e]],operation:"add"}),t!==e&&(ve({selector:"html",classNames:[le[t]],operation:"remove"}),r({mode:e}))},be={updateAppMode:Re,updateField:({selector:e,value:t,itemid:r,property:n="",itemprop:o})=>{},removeField:({selector:e})=>{let t=document.querySelector(e);t&&t.remove()},getUrnMappings:()=>[...document.querySelectorAll(_.META_SELECTOR)].reduce(((e,{name:t,content:r})=>{let[n,o]=t.replace(_.URN_PREFIX,"").split(":");return{...e,[n]:o?{...e[n],[o]:r}:r}}),{}),toggleEditableVisibility:(e,t)=>{let r=document.querySelector(e);r&&(t?r.style.removeProperty("visibility"):r.style.visibility="hidden")},updateContainer:ye,getDocumentProperties:e=>{let t={};try{for(let r of e)void 0!==document[r]?t[r]=document[r]:t[r]=null}catch(e){console.log(e)}return t},getDefinitions:async()=>{let e={},t=document.querySelectorAll(`script[type^="${ae}"]`);return await Promise.all([...t].map((async({type:t,src:r,innerText:n})=>{let o=t.replace(ae,"").replace("+json",""),i=n?(e=>{try{return JSON.parse(e)}catch(e){return console.log("parseDefinitions",e),null}})(n):await(async e=>{try{return await fetch(e).then((e=>e.json()))}catch(e){return console.log("fetchDefinitions",e),null}})(r);e[o]=i}))),e},triggerEvent:Te,openRTE:ge};(async()=>{let e=A({methods:be}),t=await e.promise;fe.getState().setEditor(t),he();let r=(()=>{let e=document.querySelector(_.META_NAMESPACE);return(null==e?void 0:e.content)?`data-${e.content}-`:_.DEFAULT_PREFIX})();fe.getState().setPrefix(r),(()=>{let e=document.createElement("script");e.id="tiny-mce-script",e.src=_.RTE_URL,document.body.appendChild(e)})(),Te(_.EVENT_APP_INITIALIZED),re({editor:t,prefix:r}),ne({editor:t}),oe({editor:t}),ie(),(e=>{fe.subscribe((e=>[e.mode]),(([t],[r])=>{t&&t!==r&&e(t)}))})((e=>{var t;let r={[g.PREVIEW]:Y,[g.EDIT]:X};null===(t=r[e])||void 0===t||t.call(r)}))})()})();